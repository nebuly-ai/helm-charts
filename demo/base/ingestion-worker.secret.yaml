apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: ingestion-worker
spec:
  provider: azure
  parameters:
    # ID of the managed identity used for authenticating with the Key Vault.
    # Can be retrieved from the outputs of the Terraform module used for provisioning the k8s cluster (field "client_id")
    # $ terraform output aks_secrets_provider_managed_identity
    userAssignedIdentityID: "85ea93ac-dcfa-48c3-8ecd-b09d691124df"
    keyvaultName: "nbllabakskv"
    tenantId: "4e16af92-dd38-417c-bf9d-a24f891a7987"
    usePodIdentity: "false"
    useVMManagedIdentity: "true"

    objects: |
      array:
        - |
          objectName: nbllab-analytics-dev-postgres-password
          objectType: secret              
          objectVersion: ""               
        - |
          objectName: nbllab-analytics-dev-postgres-user
          objectType: secret              
          objectVersion: ""
        - |
          objectName: nbllab-ingestion-worker-auth0-client-id
          objectType: secret              
          objectVersion: ""
        - |
          objectName: nbllab-ingestion-worker-auth0-client-secret
          objectType: secret              
          objectVersion: ""
        - |
          objectName: nbllab-ingestion-worker-azure-client-id
          objectType: secret
          objectVersion: ""
        - |
          objectName: nbllab-ingestion-worker-azure-client-secret
          objectType: secret
          objectVersion: ""
        - |
          objectName: nbllab-openai-api-key
          objectType: secret              
          objectVersion: ""
        - |
          objectName: nbllab-cohere-api-key
          objectType: secret              
          objectVersion: ""
        - |
          objectName: nbllabplatformhubns-connection-string          
          objectType: secret              
          objectVersion: ""
  secretObjects:
    - data:
        - key: postgres-password
          objectName: nbllab-analytics-dev-postgres-password
        - key: postgres-user
          objectName: nbllab-analytics-dev-postgres-user
        - key: oauth-client-id
          objectName: nbllab-ingestion-worker-auth0-client-id
        - key: oauth-client-secret
          objectName: nbllab-ingestion-worker-auth0-client-secret
        - key: azure-client-id
          objectName: nbllab-ingestion-worker-azure-client-id
        - key: azure-client-secret
          objectName: nbllab-ingestion-worker-azure-client-secret
        - key: openai-api-key
          objectName: nbllab-openai-api-key
        - key: cohere-api-key
          objectName: nbllab-cohere-api-key
        - key: kafka-sasl-password
          objectName: nbllabplatformhubns-connection-string
      secretName: ingestion-worker-credentials
      type: Opaque
